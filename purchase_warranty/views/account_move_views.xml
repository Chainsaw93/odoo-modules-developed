<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Heredar la vista del formulario de facturas -->
    <record id="view_account_move_form_warranty" model="ir.ui.view">
        <field name="name">account.move.form.warranty</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <!-- Agregar el campo en la pestaña "Other Info" para facturas de proveedor -->
            <xpath expr="//page[@name='other_info']//group[@name='accounting_info_group']" position="inside">
                <field name="warranty_purchase" widget="boolean_toggle"
                       invisible="move_type not in ('in_invoice', 'in_refund')"
                       help="Indica si esta factura corresponde a una compra por garantía"/>
            </xpath>
        </field>
    </record>

    <!-- Vista de lista para mostrar el campo warranty_purchase -->
    <record id="view_account_move_tree_warranty" model="ir.ui.view">
        <field name="name">account.move.tree.warranty</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_tree"/>
        <field name="arch" type="xml">
            <!-- Agregar columna para warranty_purchase en facturas de proveedor -->
            <xpath expr="//field[@name='amount_total_signed']" position="after">
                <field name="warranty_purchase" string="Garantía" optional="hide"
                       invisible="move_type not in ('in_invoice', 'in_refund')"/>
            </xpath>
        </field>
    </record>

    <!-- Vista de búsqueda para filtrar por warranty_purchase -->
    <record id="view_account_move_filter_warranty" model="ir.ui.view">
        <field name="name">account.move.search.warranty</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_account_move_filter"/>
        <field name="arch" type="xml">
            <!-- Agregar filtros para facturas por garantía -->
            <xpath expr="//search" position="inside">
                <separator/>
                <filter name="warranty_bills" string="Facturas por Garantía" 
                        domain="[('warranty_purchase', '=', True), ('move_type', 'in', ('in_invoice', 'in_refund'))]"/>
                <filter name="regular_bills" string="Facturas Regulares" 
                        domain="[('warranty_purchase', '=', False), ('move_type', 'in', ('in_invoice', 'in_refund'))]"/>
            </xpath>
            <!-- Agregar agrupación por warranty_purchase -->
            <xpath expr="//group[@expand='0']" position="inside">
                <filter name="group_by_warranty_bill" string="Por Tipo de Factura" 
                        context="{'group_by': 'warranty_purchase'}"
                        invisible="context.get('default_move_type') not in ('in_invoice', 'in_refund')"/>
            </xpath>
        </field>
    </record>

</odoo>