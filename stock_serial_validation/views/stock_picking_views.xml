<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vista principal de picking con validación -->
    <record id="view_picking_form_serial_validation" model="ir.ui.view">
        <field name="name">stock.picking.form.serial.validation</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">
            <!-- Añadir resumen de validación -->
            <xpath expr="//sheet" position="inside">
                <div class="alert alert-info" role="alert">
                    <attribute name="invisible">not serial_validation_summary</attribute>
                    <strong>Estado de Validación de Números de Serie:</strong>
                    <field name="serial_validation_summary" nolabel="1"/>
                </div>
                <div class="alert alert-warning" role="alert">
                    <attribute name="invisible">not has_serial_validation_errors</attribute>
                    <strong>⚠️ Atención:</strong> Hay errores de validación que deben corregirse antes de confirmar.
                </div>
            </xpath>

            <!-- Añadir campos de validación ocultos -->
            <xpath expr="//field[@name='state']" position="after">
                <field name="has_serial_validation_errors" invisible="1"/>
            </xpath>
        </field>
    </record>

    <!-- Vista mejorada para líneas de movimiento -->
    <record id="view_stock_move_line_detailed_operation_tree_serial" model="ir.ui.view">
        <field name="name">stock.move.line.tree.serial.validation</field>
        <field name="model">stock.move.line</field>
        <field name="inherit_id" ref="stock.view_stock_move_line_detailed_operation_tree"/>
        <field name="arch" type="xml">
            <!-- Añadir campos de validación -->
            <xpath expr="//field[@name='lot_name']" position="after">
                <field name="serial_validation_status" optional="show"/>
                <field name="serial_validation_message" optional="hide"/>
            </xpath>

            <!-- Decoraciones visuales -->
            <xpath expr="//list" position="attributes">
                <attribute name="decoration-success">serial_validation_status == 'valid'</attribute>
                <attribute name="decoration-warning">serial_validation_status == 'pending'</attribute>
                <attribute name="decoration-danger">serial_validation_status == 'invalid'</attribute>
            </xpath>

            <!-- Mejorar campos -->
            <xpath expr="//field[@name='lot_name']" position="attributes">
                <attribute name="placeholder">Escribir número de serie...</attribute>
            </xpath>
            
            <xpath expr="//field[@name='lot_id']" position="attributes">
                <attribute name="placeholder">Seleccionar serie existente...</attribute>
            </xpath>
        </field>
    </record>

    <!-- Vista de formulario para línea individual -->
    <record id="view_stock_move_line_form_serial_validation" model="ir.ui.view">
        <field name="name">stock.move.line.form.serial.validation</field>
        <field name="model">stock.move.line</field>
        <field name="inherit_id" ref="stock.view_move_line_form"/>
        <field name="arch" type="xml">
            <!-- Añadir sección de validación -->
            <xpath expr="//group" position="after">
                <group name="validation_group" string="Validación de Número de Serie">
                    <attribute name="invisible">product_id.tracking != 'serial'</attribute>
                    <field name="serial_validation_status"/>
                    <field name="serial_validation_message"/>
                </group>
            </xpath>
        </field>
    </record>
</odoo>