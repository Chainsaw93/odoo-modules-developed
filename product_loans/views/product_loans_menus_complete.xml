<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Acción mejorada para productos prestados -->
        <record id="action_loaned_products_report_enhanced" model="ir.actions.act_window">
            <field name="name">Productos Actualmente Prestados</field>
            <field name="res_model">loan.tracking.detail</field>
            <field name="view_mode">list,kanban,form</field>
            <field name="domain">[('status', '=', 'active')]</field>
            <field name="context">{
                'search_default_active': 1,
                'search_default_group_by_product': 1
            }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No hay productos prestados actualmente
                </p>
                <p>
                    Esta vista muestra todos los productos que están actualmente
                    prestados a clientes, con información detallada de cada préstamo.
                </p>
            </field>
        </record>

        <!-- Acción base usada por el menú "Productos Prestados" -->
        <record id="action_loaned_products_report" model="ir.actions.act_window">
            <field name="name">Productos Prestados</field>
            <field name="res_model">loan.tracking.detail</field>
            <field name="view_mode">list,kanban,form</field>
            <field name="domain">[('status', '=', 'active')]</field>
            <field name="context">{
                'search_default_active': 1,
                'search_default_group_by_partner': 1
            }</field>
        </record>

        <!-- Acción: Debug Tipos de Operación -->
        <record id="action_debug_picking_types" model="ir.actions.act_window">
            <field name="name">Debug: Tipos de Operación</field>
            <field name="res_model">stock.picking.type</field>
            <field name="view_mode">list,form</field>
            <field name="context">{}</field>
            <field name="target">current</field>
        </record>

        <!-- (Opcional) Acción: Debug Almacenes, ya que también la usas en otro menú -->
        <record id="action_debug_warehouses" model="ir.actions.act_window">
            <field name="name">Debug: Almacenes</field>
            <field name="res_model">stock.warehouse</field>
            <field name="view_mode">list,form</field>
            <field name="context">{}</field>
            <field name="target">current</field>
        </record>

        <!-- ===== Menús ===== -->

        <!-- Menú principal de la aplicación Préstamos -->
        <record id="menu_loans_main" model="ir.ui.menu">
            <field name="name">Préstamos</field>
            <field name="sequence">40</field>
            <field name="web_icon">product_loans,static/description/icon.png</field>
        </record>

        <!-- Sección: OPERACIONES -->
        <record id="menu_loans_operations" model="ir.ui.menu">
            <field name="name">Operaciones</field>
            <field name="parent_id" ref="menu_loans_main"/>
            <field name="sequence">10</field>
        </record>

        <!-- Menú para gestionar préstamos -->
        <record id="menu_loans_pickings" model="ir.ui.menu">
            <field name="name">Gestionar Préstamos</field>
            <field name="parent_id" ref="menu_loans_operations"/>
            <field name="action" ref="action_picking_loans"/>
            <field name="sequence">10</field>
        </record>

        <!-- Menú para préstamos vencidos -->
        <record id="menu_overdue_loans_operations" model="ir.ui.menu">
            <field name="name">Préstamos Vencidos</field>
            <field name="parent_id" ref="menu_loans_operations"/>
            <field name="action" ref="action_overdue_tracking_dashboard"/>
            <field name="sequence">20</field>
        </record>

        <!-- Sección: SEGUIMIENTO Y ANÁLISIS -->
        <record id="menu_loans_tracking" model="ir.ui.menu">
            <field name="name">Seguimiento</field>
            <field name="parent_id" ref="menu_loans_main"/>
            <field name="sequence">20</field>
        </record>

        <!-- Seguimiento detallado -->
        <record id="menu_loan_tracking_detail" model="ir.ui.menu">
            <field name="name">Seguimiento Detallado</field>
            <field name="parent_id" ref="menu_loans_tracking"/>
            <field name="action" ref="action_loan_tracking_detail"/>
            <field name="sequence">10</field>
        </record>

        <!-- Dashboard de préstamos vencidos -->
        <record id="menu_overdue_loans_tracking" model="ir.ui.menu">
            <field name="name">Dashboard Vencidos</field>
            <field name="parent_id" ref="menu_loans_tracking"/>
            <field name="action" ref="action_overdue_tracking_dashboard"/>
            <field name="sequence">20</field>
        </record>

        <!-- Sección: REPORTES -->
        <record id="menu_loans_reports" model="ir.ui.menu">
            <field name="name">Reportes</field>
            <field name="parent_id" ref="menu_loans_main"/>
            <field name="sequence">30</field>
        </record>

        <!-- Reporte analítico mejorado -->
        <record id="menu_loan_report" model="ir.ui.menu">
            <field name="name">Análisis de Préstamos</field>
            <field name="parent_id" ref="menu_loans_reports"/>
            <field name="action" ref="action_loan_report"/>
            <field name="sequence">10</field>
        </record>

        <!-- Reporte de productos prestados -->
        <record id="menu_loaned_products_report" model="ir.ui.menu">
            <field name="name">Productos Prestados</field>
            <field name="parent_id" ref="menu_loans_reports"/>
            <field name="action" ref="action_loaned_products_report"/>
            <field name="sequence">20</field>
        </record>

        <!-- Sección: HERRAMIENTAS -->
        <record id="menu_loans_tools" model="ir.ui.menu">
            <field name="name">Herramientas</field>
            <field name="parent_id" ref="menu_loans_main"/>
            <field name="sequence">40</field>
        </record>

        <!-- Wizard de notificaciones -->
        <record id="menu_loan_notifications" model="ir.ui.menu">
            <field name="name">Enviar Notificaciones</field>
            <field name="parent_id" ref="menu_loans_tools"/>
            <field name="action" ref="action_loan_notification_wizard"/>
            <field name="sequence">10</field>
        </record>

        <!-- Sección: CONFIGURACIÓN -->
        <record id="menu_loans_config" model="ir.ui.menu">
            <field name="name">Configuración</field>
            <field name="parent_id" ref="menu_loans_main"/>
            <field name="sequence">90</field>
        </record>

        <!-- Configuración contable -->
        <record id="action_loan_accounting_config" model="ir.actions.act_window">
            <field name="name">Configuración Contable</field>
            <field name="res_model">loan.accounting.manager</field>
            <field name="view_mode">form</field>
            <field name="target">inline</field>
            <field name="context">
                {
                    'allowed_company_ids': context.get('allowed_company_ids')
                }
            </field>
        </record>

        <record id="menu_loan_accounting_config" model="ir.ui.menu">
            <field name="name">Contabilidad de Préstamos</field>
            <field name="parent_id" ref="menu_loans_config"/>
            <field name="action" ref="action_loan_accounting_config"/>
            <field name="sequence">5</field>
            <field name="groups_id" eval="[(4, ref('account.group_account_manager'))]"/>
        </record>

        <!-- Gestión de almacenes de préstamos -->
        <record id="action_loans_warehouses_enhanced" model="ir.actions.act_window">
            <field name="name">Almacenes de Préstamos</field>
            <field name="res_model">stock.warehouse</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('warehouse_type', '=', 'loans')]</field>
            <field name="context">{'default_warehouse_type': 'loans'}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    ¡Crea tu primer almacén de préstamos!
                </p>
                <p>
                    Los almacenes de préstamos son ubicaciones especiales donde se 
                    gestiona el inventario de productos prestados a clientes.
                </p>
                <p>
                    Cada almacén de préstamos puede tener múltiples ubicaciones
                    para diferentes clientes o tipos de préstamos.
                </p>
            </field>
        </record>

        <record id="menu_loans_warehouses" model="ir.ui.menu">
            <field name="name">Almacenes de Préstamos</field>
            <field name="parent_id" ref="menu_loans_config"/>
            <field name="action" ref="action_loans_warehouses_enhanced"/>
            <field name="sequence">10</field>
        </record>

        <!-- Tipos de operación para préstamos -->
        <record id="action_loans_picking_types_enhanced" model="ir.actions.act_window">
            <field name="name">Tipos de Operación</field>
            <field name="res_model">stock.picking.type</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('warehouse_id.warehouse_type', '=', 'loans')]</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Configura tipos de operación para préstamos
                </p>
                <p>
                    Los tipos de operación definen los flujos de trabajo específicos
                    para diferentes tipos de préstamos (internos, externos, temporales, etc.).
                </p>
            </field>
        </record>

        <record id="menu_loans_picking_types" model="ir.ui.menu">
            <field name="name">Tipos de Operación</field>
            <field name="parent_id" ref="menu_loans_config"/>
            <field name="action" ref="action_loans_picking_types_enhanced"/>
            <field name="sequence">20</field>
        </record>

        <!-- Configuración de productos para préstamos -->
        <record id="action_loan_products_config" model="ir.actions.act_window">
            <field name="name">Productos - Configuración Préstamos</field>
            <field name="res_model">product.template</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('allow_loans', '=', True)]</field>
            <field name="context">{
                'default_allow_loans': True,
                'search_default_allow_loans': 1
            }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Configura qué productos pueden ser prestados
                </p>
                <p>
                    Define restricciones, advertencias y configuraciones específicas
                    para productos que pueden ser prestados.
                </p>
            </field>
        </record>

        <record id="menu_loan_products_config" model="ir.ui.menu">
            <field name="name">Configuración de Productos</field>
            <field name="parent_id" ref="menu_loans_config"/>
            <field name="action" ref="action_loan_products_config"/>
            <field name="sequence">30</field>
        </record>

        <!-- Clientes con préstamos activos -->
        <record id="action_loan_partners" model="ir.actions.act_window">
            <field name="name">Clientes con Préstamos</field>
            <field name="res_model">res.partner</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('active_loans_count', '>', 0)]</field>
            <field name="context">{'search_default_has_active_loans': 1}</field>
        </record>

        <record id="menu_loan_partners" model="ir.ui.menu">
            <field name="name">Clientes</field>
            <field name="parent_id" ref="menu_loans_config"/>
            <field name="action" ref="action_loan_partners"/>
            <field name="sequence">40</field>
        </record>

        <!-- Sección: ADMINISTRACIÓN -->
        <record id="menu_loans_admin" model="ir.ui.menu">
            <field name="name">Administración</field>
            <field name="parent_id" ref="menu_loans_main"/>
            <field name="sequence">95</field>
            <field name="groups_id" eval="[(4, ref('base.group_system'))]"/>
        </record>

        <!-- Valoración de préstamos -->
        <record id="action_loan_valuation_tracker" model="ir.actions.act_window">
            <field name="name">Seguimiento de Valoración</field>
            <field name="res_model">loan.valuation.tracker</field>
            <field name="view_mode">list,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Seguimiento de valoración de préstamos
                </p>
                <p>
                    Monitorea las diferencias de valoración entre el momento del préstamo
                    y la conversión a venta o devolución.
                </p>
            </field>
        </record>

        <record id="menu_loan_valuation_tracker" model="ir.ui.menu">
            <field name="name">Valoración de Préstamos</field>
            <field name="parent_id" ref="menu_loans_admin"/>
            <field name="action" ref="action_loan_valuation_tracker"/>
            <field name="sequence">10</field>
        </record>

        <!-- Asientos contables de préstamos -->
        <record id="action_loan_accounting_moves" model="ir.actions.act_window">
            <field name="name">Asientos de Préstamos</field>
            <field name="res_model">account.move</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('is_loan_entry', '=', True)]</field>
            <field name="context">{'search_default_posted': 1}</field>
        </record>

        <record id="menu_loan_accounting_moves" model="ir.ui.menu">
            <field name="name">Asientos Contables</field>
            <field name="parent_id" ref="menu_loans_admin"/>
            <field name="action" ref="action_loan_accounting_moves"/>
            <field name="sequence">20</field>
            <field name="groups_id" eval="[(4, ref('account.group_account_user'))]"/>
        </record>

        <!-- Debug: Todos los tipos de operación (solo para administradores) -->
        <record id="menu_debug_picking_types" model="ir.ui.menu">
            <field name="name">Debug: Tipos de Operación</field>
            <field name="parent_id" ref="menu_loans_admin"/>
            <field name="action" ref="action_debug_picking_types"/>
            <field name="sequence">80</field>
            <field name="groups_id" eval="[(4, ref('base.group_system'))]"/>
        </record>

        <!-- Debug: Todos los almacenes -->
        <record id="menu_debug_warehouses" model="ir.ui.menu">
            <field name="name">Debug: Almacenes</field>
            <field name="parent_id" ref="menu_loans_admin"/>
            <field name="action" ref="action_debug_warehouses"/>
            <field name="sequence">90</field>
            <field name="groups_id" eval="[(4, ref('base.group_system'))]"/>
        </record>
    </data>
</odoo>
